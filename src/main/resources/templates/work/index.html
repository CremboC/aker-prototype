<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head lang="en" th:include="fragments/common :: head"></head>
<body>

<div th:replace="fragments/common :: header">...</div>

<div class="container">

    <div class="page-header">
        <h2>
            Order Work
        </h2>
    </div>

    <div class="col-md-12">
        <div class="row">
            <h3>Choose Product</h3>

            <div class="form-group">
                <select name="product" id="products" class="form-control">
                    <option value=""></option>
                </select>
            </div>

            <h3>Groups</h3>

            only groups of type that fits workflow

            <h3>Samples</h3>

            <div th:replace="samples/table :: samplestable (${'append-samples'}, ${'load-samples'}, ${'metadata-samples'})"></div>

        </div>

        <div class="row">

        </div>
    </div>

    <!--<div class="col-md-2">-->
    <!--<ul class="nav nav-pills nav-stacked">-->
    <!--<li class="active"><a href="#">Home</a></li>-->
    <!--<li><a href="#">Profile</a></li>-->
    <!--<li><a href="#">Messages</a></li>-->
    <!--</ul>-->
    <!--</div>-->

</div>

<script id="select-template" type="text/x-handlebars-template">
    <option value="{{ index }}">
        {{ name }}
    </option>
</script>


<div th:replace="fragments/common :: footer"></div>

<script type="application/javascript">
    $(document).ready(function () {

        // compile template using Handlebars

        var $template = $('#select-template');
        var $products = $('#products');

        var source = $template.html();
        var template = Handlebars.compile(source);

        var productQuery = $.ajax('http://localhost:8081/products/');

        productQuery.then(function (data) {
            var products = data._embedded.products;
            var sampleHtml = '';

            $.each(products, function (index, product) {
                product.index = index;
                sampleHtml += template(product);
            });

            $products.append(sampleHtml);

            $products.on('change', function (e) {
                var valueSelected = this.value;

                var validTypes = [];

                $.each(products[valueSelected].inputMaterial, function (index, material) {
                    validTypes.push(material.type.value);
                });

                console.log(validTypes);

                $('.jqp-samples').pager({
                    url: '/samples/byType',
                    template: '#sample-template',
                    loadButton: '#load-samples',
                    appendBefore: '#append-samples',
                    metadata: '#metadata-samples',
                    scrollLoad: true,
                    data: {
                        types: validTypes.join(',')
                    }
                });
            });

        }, function (status, code, c) {

        });

    });
</script>

</body>
</html>